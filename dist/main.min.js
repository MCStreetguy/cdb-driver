"use strict";var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,s,r){return s&&t(e.prototype,s),r&&t(e,r),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _require=require("Base64"),btoa=_require.btoa;function _isset(t,e){if(e){i=!0;try{var s=t instanceof e}catch(t){s=!1}try{var r=(void 0===t?"undefined":_typeof(t))===e}catch(t){r=!1}}else var i=!1;return null!=t&&null!=t&&i&&(s||r)}var CDBDriver=function(){function t(e){if(_classCallCheck(this,t),_isset(e,"object")){if(!_isset(e.host,"string")||!_isset(e.port,"number"))throw new TypeError("CDBDriver configuration is missing required keys!");this.host=e.host+":"+e.port,_isset(e.user,"string")&&_isset(e.pass,"string")?(this._auth=!0,this.user=e.user,this.pass=e.pass):this._auth=!1}else{if(!_isset(e,"string"))throw new TypeError("Invalid configuration passed to CDBDriver constructor!");try{if(e.includes("@")){this._auth=!0;var s=e.split("@"),r=s[0].split("//")[0]+"//",i=s[0].split("//")[1];this.user=i.split(":")[0],this.pass=i.split(":")[1],this.host=r+s[1].split(":")[0]+":"+parseInt(s[1].split(":")[1])}else this._auth=!1,this.host=e}catch(t){throw new TypeError("An error occurred while parsing CouchDB URL string.")}}this.host.endsWith("/")||(this.host=this.host+"/");try{new XMLHttpRequest,this._mode="xhr"}catch(t){throw this._mode="curl",new Error("CDBDriver currently not supports CURL mode!")}}return _createClass(t,[{key:"_getAuthHeader",value:function(){return"Basic "+btoa(this.user+":"+this.pass)}},{key:"_setAuthHeader",value:function(t){return t.setRequestHeader("Authorization",this._getAuthHeader())}},{key:"_buildCURL",value:function(t){var e="curl ";return _isset(t.method,"string")?e+="-X "+t.method+" ":e+="-X GET ",t.verbose&&(e+="-v "),_isset(t.data,"object")?(e+='-H "Content-Type: application/json" ',e+='-d "'+JSON.stringify(t.data)+'" '):_isset(t.data,"string")&&(e+='-d "'+t.data+'"'),this._auth&&(e+='-H "Authorization: '+this._getAuthHeader()+'" '),_isset(t.location,"string")?e+=this.host+t.location:e+=this.host,e}},{key:"_parseCURLResponse",value:function(t,e){var s,r;if(e){s={},r="",t.split("\n").forEach(function(t,e,i){if(t.startsWith("*"));else if(t.startsWith(">"));else if(t.startsWith("<")){t.replace("< ","");t.includes("HTTP/")&&(s.code=parseInt(t.replace(new RegExp("HTTP/[^s]+ "),"")))}else r+=t});try{s.body=JSON.parse(r)}catch(t){s.body=r}finally{return s}}else try{s=JSON.parse(t)}catch(e){return t}finally{return s}}},{key:"info",value:function(t){if("xhr"==this._mode){var e=new XMLHttpRequest;if(!_isset(t,"function"))return e.open("GET",this.host,!1),this._auth&&(e=this._setAuthHeader(e)),e.send(),{state:e.status,response:e.response};e.addEventListener("load",function(s){t({state:e.status,response:e.response})}),e.open("GET",this.host),this._auth&&(e=this._setAuthHeader(e)),e.send()}}},{key:"allDbs",value:function(t){if("xhr"==this._mode){var e=new XMLHttpRequest;if(!_isset(t,"function"))return e.open("GET",this.host+"_all_dbs",!1),this._auth&&(e=this._setAuthHeader(e)),e.send(),{status:e.status,response:e.response};e.addEventListener("load",function(s){t({state:e.status,response:e.response})}),e.open("GET",this.host+"_all_dbs"),this._auth&&(e=this._setAuthHeader(e)),e.send()}else _isset(t,"function")}},{key:"db",value:function(t,e){if(!_isset(t,"string"))throw new TypeError("CDBDriver.db() is missing required argument: identifier!");if("xhr"==this._mode){var s=new XMLHttpRequest;if(!_isset(e,"function"))return s.open("GET",this.host+t,!1),this._auth&&(s=this._setAuthHeader(s)),s.send(),{status:s.status,response:s.response};s.addEventListener("load",function(t){e({state:s.status,response:s.response})}),s.open("GET",this.host+t),this._auth&&(s=this._setAuthHeader(s)),s.send()}}}]),t}();try{module.exports=CDBDriver}catch(t){}